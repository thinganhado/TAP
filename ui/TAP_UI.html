<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FraudOps demo dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>html,body,#root{height:100%}</style>
  <!-- React 18 UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel so you can paste JSX anywhere, for demos only -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-50 text-slate-900">
  <div id="root"></div>

  <script type="text/babel">
    const {useEffect, useMemo, useState} = React;

    // helpers
    const now = () => new Date().toLocaleString();
    const uid = () => Math.random().toString(36).slice(2,8);
    const pick = (arr) => arr[Math.floor(Math.random()*arr.length)];

    const USERNAMES = ["alicia","bchan","cnguyen","dpatel","ekim","fgarcia","zzhao","lwang","hsato","klee"];
    const DEVICES = ["iPhone 15","Pixel 8","Windows 11","MacBook M2","iPad","Samsung S23"];
    const IPS = ["13.7.2.40","77.21.5.8","201.16.9.99","189.54.31.4","10.2.3.7","54.202.1.12"];
    const CITIES = ["London","Singapore","Sydney","Toronto","New York","Tokyo"];
    const CHANNELS = ["web","mobile","api"];
    const EVENT_TYPES = ["account takeover","velocity breach","impossible travel","card testing","bot spike"];
    const REASONS = [
      "ip risk score high",
      "device not seen",
      "geo velocity high",
      "password resets spike",
      "failed cvv tries",
      "proxy suspected"
    ];

    function riskColor(score){
      if(score>=85) return "bg-red-100 text-red-700 border-red-300";
      if(score>=65) return "bg-amber-100 text-amber-800 border-amber-300";
      return "bg-slate-100 text-slate-700 border-slate-300";
    }
    const RiskBadge = ({score}) => (
      <span class={`inline-flex items-center rounded-md border px-2 py-0.5 text-xs font-medium ${riskColor(score)}`}>Risk {score}</span>
    );

    const Kpi = ({title,value,sub}) => (
      <div class="rounded-2xl border bg-white p-4 shadow-sm">
        <div class="text-xs tracking-wide text-slate-500">{title}</div>
        <div class="mt-1 text-2xl font-bold">{value}</div>
        <div class="text-xs text-slate-500">{sub}</div>
      </div>
    );

    function App(){
      const [tab, setTab] = useState("users");
      const [userFeed, setUserFeed] = useState(()=>Array.from({length:10}, mockUserEvent));
      const [txnFeed, setTxnFeed] = useState(()=>Array.from({length:10}, mockTxnEvent));
      const [alerts, setAlerts] = useState(()=>Array.from({length:8}, mockAlert));
      const [query, setQuery] = useState("");
      const [openCase, setOpenCase] = useState(null);

      useEffect(()=>{
        const t1 = setInterval(()=> setUserFeed(f=>[mockUserEvent(),...f].slice(0,50)), 2500);
        const t2 = setInterval(()=> setTxnFeed(f=>[mockTxnEvent(),...f].slice(0,50)), 3200);
        const t3 = setInterval(()=> setAlerts(a=>[mockAlert(),...a].slice(0,80)), 7000);
        return ()=>{clearInterval(t1);clearInterval(t2);clearInterval(t3)};
      },[]);

      const filteredAlerts = useMemo(()=>{
        if(!query) return alerts;
        const q = query.toLowerCase();
        return alerts.filter(r => [r.userId, r.type, r.reason, r.channel].some(x => String(x).toLowerCase().includes(q)));
      }, [alerts, query]);

      return (
        <div class="h-full p-6 space-y-6">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <span class="inline-flex h-8 w-8 items-center justify-center rounded-xl bg-indigo-600 text-white font-bold">F</span>
              <h1 class="text-2xl font-bold">Fraud operations</h1>
            </div>
            <div class="flex items-center gap-2">
              <button class="rounded-xl border px-3 py-1.5 text-sm" onClick={()=>{setUserFeed(Array.from({length:10}, mockUserEvent)); setTxnFeed(Array.from({length:10}, mockTxnEvent)); setAlerts(Array.from({length:8}, mockAlert));}}>Reset demo data</button>
              <button class="rounded-xl bg-indigo-600 text-white px-3 py-1.5 text-sm" onClick={()=> setAlerts(a=>[mockAlert(),...a])}>Inject alert</button>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <Kpi title="Live users" value={userFeed.length} sub="rolling feed" />
            <Kpi title="Live transactions" value={txnFeed.length} sub="rolling feed" />
            <Kpi title="Alerts today" value={alerts.length} sub="all sources" />
            <Kpi title="Median risk" value={Math.round(avg(alerts.map(a=>a.score))||0)} sub="computed" />
          </div>

          <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
            {/* left, live feeds */}
            <div class="rounded-2xl border bg-white p-4 shadow-sm xl:col-span-1">
              <div class="flex items-center gap-4">
                <button onClick={()=>setTab("users")} class={`text-sm rounded-lg px-3 py-1.5 border ${tab==='users'?'bg-slate-900 text-white':'bg-white'}`}>User activity</button>
                <button onClick={()=>setTab("txns")} class={`text-sm rounded-lg px-3 py-1.5 border ${tab==='txns'?'bg-slate-900 text-white':'bg-white'}`}>Transactions</button>
              </div>
              <div class="mt-4 h-[360px] overflow-auto">
                {tab==='users' ? <UserTable rows={userFeed}/> : <TxnTable rows={txnFeed}/>} 
              </div>
            </div>

            {/* right, alerts table */}
            <div class="rounded-2xl border bg-white p-4 shadow-sm xl:col-span-2">
              <div class="flex items-center justify-between">
                <h3 class="text-base font-semibold">Alerts and anomaly queue</h3>
                <input value={query} onChange={(e)=>setQuery(e.target.value)} placeholder="Search user, type, reason" class="rounded-xl border px-3 py-1.5 text-sm w-72" />
              </div>
              <div class="mt-4 h-[460px] overflow-auto">
                <table class="w-full text-sm">
                  <thead class="sticky top-0 bg-white">
                    <tr class="text-left text-slate-500">
                      <th class="py-2 pr-2">Type</th>
                      <th class="py-2 pr-2">Risk</th>
                      <th class="py-2 pr-2">Reason</th>
                      <th class="py-2 pr-2">User</th>
                      <th class="py-2 pr-2">Channel</th>
                      <th class="py-2 pr-2">When</th>
                      <th class="py-2 text-right">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    {filteredAlerts.map(a => (
                      <tr key={a.id} class="border-t hover:bg-slate-50">
                        <td class="py-2 pr-2">{a.type}</td>
                        <td class="py-2 pr-2"><RiskBadge score={a.score}/></td>
                        <td class="py-2 pr-2 max-w-[260px] truncate" title={a.reason}>{a.reason}</td>
                        <td class="py-2 pr-2">{a.userId}</td>
                        <td class="py-2 pr-2 uppercase text-xs">{a.channel}</td>
                        <td class="py-2 pr-2 text-slate-500">{a.time}</td>
                        <td class="py-2 pl-2 text-right"><button class="rounded-lg bg-slate-900 text-white px-2.5 py-1 text-xs" onClick={()=> setOpenCase(a)}>Analyse</button></td>
                      </tr>
                    ))}
                  </tbody>
                </table>
                <div class="mt-2 text-xs text-slate-500">{filteredAlerts.length} alerts</div>
              </div>
            </div>
          </div>

          {/* case view modal */}
          {openCase && <CaseModal record={openCase} onClose={()=>setOpenCase(null)} />}
        </div>
      );
    }

    const UserTable = ({rows}) => (
      <table class="w-full text-sm">
        <thead class="sticky top-0 bg-white">
          <tr class="text-left text-slate-500">
            <th class="py-2 pr-2">User</th>
            <th class="py-2 pr-2">Event</th>
            <th class="py-2 pr-2">Channel</th>
            <th class="py-2 pr-2">Device</th>
            <th class="py-2 text-right">When</th>
          </tr>
        </thead>
        <tbody>
          {rows.map(e => (
            <tr key={e.id} class="border-t">
              <td class="py-2 pr-2 font-medium">{e.userId}</td>
              <td class="py-2 pr-2">{e.event}</td>
              <td class="py-2 pr-2 uppercase text-xs">{e.channel}</td>
              <td class="py-2 pr-2 truncate max-w-[120px]" title={e.device}>{e.device}</td>
              <td class="py-2 pl-2 text-right text-slate-500">{e.time}</td>
            </tr>
          ))}
        </tbody>
      </table>
    );

    const TxnTable = ({rows}) => (
      <table class="w-full text-sm">
        <thead class="sticky top-0 bg-white">
          <tr class="text-left text-slate-500">
            <th class="py-2 pr-2">Txn id</th>
            <th class="py-2 pr-2">User</th>
            <th class="py-2 pr-2">Amount</th>
            <th class="py-2 pr-2">City</th>
            <th class="py-2 text-right">When</th>
          </tr>
        </thead>
        <tbody>
          {rows.map(t => (
            <tr key={t.id} class="border-t">
              <td class="py-2 pr-2 font-mono text-xs">{t.id}</td>
              <td class="py-2 pr-2 font-medium">{t.userId}</td>
              <td class="py-2 pr-2">${t.amount.toLocaleString()}</td>
              <td class="py-2 pr-2">{t.city}</td>
              <td class="py-2 pl-2 text-right text-slate-500">{t.time}</td>
            </tr>
          ))}
        </tbody>
      </table>
    );

    function CaseModal({record, onClose}){
      const [tab, setTab] = useState("overview");
      const profile = useMemo(()=> mockProfile(record.userId), [record]);
      const txnHistory = useMemo(()=> mockTxnHistory(record.userId), [record]);
      const beh = useMemo(()=> mockBehaviorSeries(), [record]);
      const graph = useMemo(()=> mockGraph(record.userId), [record]);

      return (
        <div class="fixed inset-0 z-50 flex items-center justify-center">
          <div class="absolute inset-0 bg-black/30" onClick={onClose}></div>
          <div class="relative z-10 w-[1100px] max-w-[95vw] rounded-2xl bg-white shadow-xl border">
            <div class="flex items-center justify-between p-5 border-b">
              <div class="flex items-center gap-3">
                <div class="text-lg font-semibold">Case {record.id}</div>
                <RiskBadge score={record.score}/>
              </div>
              <button class="rounded-lg border px-3 py-1.5 text-sm" onClick={onClose}>Close</button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 p-6">
              {/* left, profile and trend */}
              <div class="lg:col-span-1 space-y-4">
                <div class="rounded-xl border p-4">
                  <div class="text-base font-semibold mb-3">User profile snapshot</div>
                  <div class="flex items-center gap-3 mb-3">
                    <div class="h-10 w-10 rounded-full bg-slate-200 flex items-center justify-center font-bold">{initials(profile.name)}</div>
                    <div>
                      <div class="font-semibold">{profile.name}</div>
                      <div class="text-xs text-slate-500">{profile.id}</div>
                    </div>
                  </div>
                  <div class="grid grid-cols-2 gap-3 text-sm">
                    <Field label="Account age" value={`${profile.age} days`} />
                    <Field label="Last login" value={profile.lastLogin} />
                    <Field label="Devices" value={profile.devices.join(", ")} />
                    <Field label="Primary ip" value={profile.ip} />
                  </div>
                  <div class="mt-4">
                    <div class="text-xs text-slate-500 mb-1">Risk breakdown</div>
                    <div class="h-2 w-full rounded-full bg-slate-200">
                      <div class="h-2 rounded-full bg-red-500" style={{width: record.score+"%"}}></div>
                    </div>
                  </div>
                </div>

                <div class="rounded-xl border p-4">
                  <div class="text-base font-semibold mb-3">Behavior trend</div>
                  <MiniBars data={beh} />
                </div>
              </div>

              {/* right, tabs and actions */}
              <div class="lg:col-span-2 space-y-4">
                <div class="flex items-center gap-2">
                  {['overview','txns','behavior','graph'].map(key => (
                    <button key={key} onClick={()=>setTab(key)} class={`text-sm rounded-lg px-3 py-1.5 border ${tab===key?'bg-slate-900 text-white':'bg-white'}`}>{key}</button>
                  ))}
                </div>

                {tab==='overview' && (
                  <div class="rounded-xl border p-0 overflow-hidden">
                    <table class="w-full text-sm">
                      <tbody>
                        <Tr field="Signup city" value={profile.city} />
                        <Tr field="Preferred channel" value={profile.channel.toUpperCase()} />
                        <Tr field="Average ticket" value={`$${profile.avgTicket.toLocaleString()}`} />
                        <Tr field="Auth failures last 24h" value={profile.authFails} />
                      </tbody>
                    </table>
                  </div>
                )}

                {tab==='txns' && (
                  <div class="rounded-xl border p-0 overflow-hidden max-h-[300px] overflow-auto">
                    <table class="w-full text-sm">
                      <thead class="sticky top-0 bg-white">
                        <tr class="text-left text-slate-500">
                          <th class="py-2 pr-2">Txn id</th>
                          <th class="py-2 pr-2">Amount</th>
                          <th class="py-2 pr-2">Type</th>
                          <th class="py-2 pr-2">City</th>
                          <th class="py-2 pr-2">When</th>
                        </tr>
                      </thead>
                      <tbody>
                        {txnHistory.map(t => (
                          <tr key={t.id} class="border-t">
                            <td class="py-2 pr-2 font-mono text-xs">{t.id}</td>
                            <td class="py-2 pr-2">${t.amount.toLocaleString()}</td>
                            <td class="py-2 pr-2">{t.kind}</td>
                            <td class="py-2 pr-2">{t.city}</td>
                            <td class="py-2 pr-2 text-slate-500">{t.time}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}

                {tab==='behavior' && (
                  <div class="rounded-xl border p-4">
                    <MiniBars data={beh} showAxis />
                  </div>
                )}

                {tab==='graph' && (
                  <div class="rounded-xl border p-4">
                    <GraphPanel graph={graph} />
                    <div class="text-xs text-slate-500">Blue user, yellow devices, red linked accounts</div>
                  </div>
                )}

                <div class="flex justify-end gap-2">
                  <button class="rounded-lg border px-3 py-1.5 text-sm">Put in review</button>
                  <button class="rounded-lg border px-3 py-1.5 text-sm">Mark clean</button>
                  <button class="rounded-lg bg-red-600 text-white px-3 py-1.5 text-sm">Mark fraud</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const Field = ({label, value}) => (
      <div>
        <div class="text-xs text-slate-500">{label}</div>
        <div class="font-medium truncate" title={value}>{value}</div>
      </div>
    );

    const Tr = ({field, value}) => (
      <tr class="border-t">
        <td class="py-2 px-3 w-52 text-slate-500">{field}</td>
        <td class="py-2 px-3">{value}</td>
      </tr>
    );

    function MiniBars({data, showAxis}){
      return (
        <div class="h-40 flex items-end gap-1">
          {data.map((d,i)=> (
            <div key={i} class="w-5 bg-indigo-200" style={{height: (d.score+10)+"%"}} title={`D${i+1}: ${d.score}`}></div>
          ))}
        </div>
      );
    }

    function GraphPanel({graph}){
      const W=900, H=240;
      const cx = (i) => 120 + i*150;
      const cy = (row) => 60 + row*90;
      const nodes = [
        { id: graph.user, label: graph.user, row: 1, col: 2, kind: "user" },
        ...graph.devices.map((d,i)=>({ id:d, label:d, row:0, col:i+1, kind:"device" })),
        ...graph.accounts.map((a,i)=>({ id:a, label:a, row:2, col:i+1, kind:"account" })),
      ];
      const links = [
        ...graph.devices.map(d=>({s:d,t:graph.user})),
        ...graph.accounts.map(a=>({s:graph.user,t:a})),
      ];
      const pos = Object.fromEntries(nodes.map(n=>[n.id,{x:cx(n.col),y:cy(n.row)}]));
      return (
        <svg viewBox={`0 0 ${W} ${H}`} class="w-full">
          {links.map((l,i)=>(
            <line key={i} x1={pos[l.s].x} y1={pos[l.s].y} x2={pos[l.t].x} y2={pos[l.t].y} stroke="rgb(148 163 184)" strokeWidth="2" />
          ))}
          {nodes.map(n=> (
            <g key={n.id} transform={`translate(${pos[n.id].x},${pos[n.id].y})`}>
              <circle r="22" fill={n.kind==="user"?"rgb(37 99 235)": n.kind==="device"?"rgb(245 158 11)":"rgb(239 68 68)"} />
              <text textAnchor="middle" y="38" class="text-[10px] fill-slate-600">{n.label}</text>
            </g>
          ))}
        </svg>
      );
    }

    // mock data
    function mockUserEvent(){
      const u = pick(USERNAMES);
      return { id: uid(), userId: u, event: pick(["login","logout","password reset","profile update","2fa challenge"]), channel: pick(CHANNELS), device: pick(DEVICES), time: now() };
    }
    function mockTxnEvent(){
      const u = pick(USERNAMES);
      return { id: uid(), userId: u, amount: Math.floor(20+Math.random()*4000), city: pick(CITIES), time: now() };
    }
    function mockAlert(){
      const u = pick(USERNAMES);
      const score = Math.floor(40+Math.random()*60);
      return { id: uid(), type: pick(EVENT_TYPES), score, reason: pick(REASONS), userId: u, channel: pick(CHANNELS), time: now() };
    }
    function mockProfile(userId){
      return { id:userId, name: userId.replace(/\b\w/g,c=>c.toUpperCase()), age: 120+Math.floor(Math.random()*640), lastLogin: now(), devices: Array.from(new Set([pick(DEVICES), pick(DEVICES)])).slice(0,2), ip: pick(IPS), city: pick(CITIES), channel: pick(CHANNELS), avgTicket: Math.floor(60+Math.random()*600), authFails: Math.floor(Math.random()*5) };
    }
    function mockTxnHistory(userId){
      return Array.from({length: 20}, ()=> ({ id: uid(), amount: Math.floor(Math.random()*9000), kind: pick(["payment","transfer","topup","withdrawal"]), city: pick(CITIES), time: now() }));
    }
    function mockBehaviorSeries(){
      return Array.from({length: 14}, (_,i)=> ({ d:`D${i+1}`, score: Math.floor(20+Math.random()*80) }));
    }
    function mockGraph(userId){
      return { user:userId, devices: Array.from(new Set([pick(DEVICES),pick(DEVICES),pick(DEVICES)])).slice(0,3), accounts: Array.from(new Set([uid(),uid(),uid()])).slice(0,3) };
    }
    function initials(name="U"){ return name.split(" ").map(s=>s[0]).join("").slice(0,2).toUpperCase(); }
    function avg(xs){ return xs.length ? xs.reduce((a,b)=>a+b,0)/xs.length : 0; }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
